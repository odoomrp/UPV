<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
    		<record model="ir.ui.view" id="account_invoice_line_just_search_view_inh_budgetary">
                <field name="name">account.invoice.line.just.search.view.inh.budgetary</field>
                <field name="model">account.invoice.line</field>
                <field name="priority" eval="10"/>
                <field name="arch" type="xml">
					<search string="Incoming invoices">
						<field name="inv_date"/>
						<field name="account_analytic_id" string="Project"/>
						<field name="partner_id" string="Supplier"/>
						<field name="purchase_type" string="Cost Type"/>
						<field name="name" string="Concept"/>
						<field name="price_subtotal" string="Amount"/>
					</search>
				</field>
			</record>
			<record model="ir.ui.view" id="account_invoice_line_just_form_view_inh_budgetary">
                <field name="name">account.invoice.line.just.form.view.inh.budgetary</field>
                <field name="model">account.invoice.line</field>
                <field name="priority" eval="30"/>
                <field name="arch" type="xml">
                	<form string="Invoice Line">
                		<field name="invoice_type" colspan="4"/>
                		<field name="product_id" on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, context, parent.company_id)"/>
	                    <field colspan="2" name="name"/>
	                    <label string="Quantity :" align="1.0"/>
	                    <group colspan="1" col="2">
	                        <field name="quantity" class="oe_inline"/>
                            <field name="uos_id" class="oe_inline" groups="product.group_uom"
                              on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, context, parent.company_id)"/>
	                    </group>
	                    <field name="price_unit"/>
	                    <field domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id" on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"/>
	                    <field name="discount" groups="sale.group_discount_per_so_line"/>
	                    <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', parent.company_id), ('parent_id', '!=', False)]" name="account_analytic_id" groups="analytic.group_analytic_accounting"/>
                    	<field name="company_id" groups="base.group_multi_company" readonly="1"/>
                    	<notebook colspan="4">
                			<page string="Invoice Info.">
		                		<field name="partner_id" string="Supplier"/>
		                		<field name="vat"/>
	                    		<field name="purchase_type" string="Cost Type"/>
	                    		<field name="move_id"/>
	                    		<field name="inv_date"/>
	                    		<field name="last_pay_date"/>
	                    		<group colspan="4" col="6">
	                    		<field name="paid_import"/>
	                    		<field name="justified_percent"/>
	                    		<field name="justified_import" sum="Justified Amount"/>
	                    		</group>
	                    		<newline/>
	                    		<field name="project_ids" nolabel="1" colspan="4"/>
                			</page>
                			<page string="Notes">
                				<separator string="Notes" colspan="4"/>
                    			<field colspan="4" name="note" nolabel="1"/>
                			</page>
                			<page string="Taxes">
                				<separator colspan="4" string="Taxes"/>
                    			<field colspan="4" name="invoice_line_tax_id" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]" nolabel="1"/>
                			</page>
                			<page string="Justification import">
                				<field colspan="4" name="justified_invoice_id" nolabel="1" context="{'name':'Justification Import}"/>
                			</page>
                		</notebook>
                		</form>
                	</field>
                	
            </record>
			<record model="ir.ui.view" id="account_invoice_line_just_tree_view_budgetary">
                <field name="name">account.invoice.line.just.tree.view.budgetary</field>
                <field name="model">account.invoice.line</field>
                <field name="priority" eval="30"/>
                <field name="arch" type="xml">
                    <tree string="Incoming invoices" colors="blue:(justified_percent&gt;0 and (paid_import-price_subtotal)&lt;0);green:justified_percent&gt;0;red:(paid_import-price_subtotal)&lt;0;" editable="top">
		                <field name="purchase_type" string="Cost Type" readonly="1"/>
		                <field name="invoice_type"  invisible="1"/>
		                <field name="project_id" readonly="1"/>
		                <field name="partner_id" string="Supplier" readonly="1"/>
		                <field name="vat" readonly="1"/>
		                <field name="invoice_id" readonly="1"/>
	                    <field name="price_subtotal" readonly="1"/>
	                    <field name="inv_date" readonly="1"/>
	                    <field name="last_pay_date" readonly="1"/>
	                    <field name="paid_import" readonly="1"/>
	                    <field name="move_id" readonly="1"/>
	                    <field name="justified_percent" readonly="1"/>
	                    <field name="justified_import" sum="Justified Amount" readonly="1"/>
	                    <field name="project_text_list" readonly="1"/>
	                    <field name="to_justified_import" on_change="onchange_to_import(to_justified_import, price_subtotal)"/>
	                    <field name="to_justified_percent" on_change="onchange_to_percent(to_justified_percent, price_subtotal)"/>
                    </tree>
                </field>
            </record>
            
            
            
		<record model="ir.ui.view" id="invoice_supplier_form_ext3_inh_budgetary">
			<field name="name">invoice.supplier.form.ext3.in._budgetary</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_supplier_form" />
			<field name="arch" type="xml">
				<field name="invoice_line" position="attributes">
                    <attribute name="context">{'partner_id': partner_id, 'price_type': context.get('price_type') or False, 'type': type, 'invoice_type':type}</attribute>
				</field> 					
			</field>
		</record>      
		
		<record model="ir.ui.view" id="invoice_form_form_ext3_inh_budgetary">
			<field name="name">invoice.form.form.ext3.inh.budgetary</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_form" />
			<field name="arch" type="xml">
				<field name="invoice_line" position="attributes"> 
                	<attribute name="context">{'type': type, 'invoice_type':type}</attribute>
				</field> 					
			</field>
		</record>           

	    	<record id="seq_type_proj_jus" model="ir.sequence.type">
				<field name="name">Project Justification</field>
				<field name="code">project.justification</field>
			</record>		
			
			<!-- DEFINO LAS SECUENCIAS -->
			<record id="seq_proj_jus" model="ir.sequence">
				<field name="name">Project Justification</field>
				<field name="code">project.justification</field>
				<field eval="5" name="padding"/>
				<field name="prefix">PJ-</field>
			</record>
    
    		<record model="ir.ui.view" id="justification_invoice_tree_view">
                <field name="name">justified.invoice.tree</field>
                <field name="model">justified.invoice.import</field>
                <field name="type">tree</field>
                <field name="arch" type="xml">
                    <tree string="Justified Import">
                    	<field name="justification_id"/>
                    	<field name="to_justified_import"/>
                    </tree>
                </field>
            </record>
    
            <record model="ir.ui.view" id="project_justification_tree_view">
                <field name="name">project.justification.tree</field>
                <field name="model">project.justification</field>
                <field name="arch" type="xml">
                    <tree string="Project Justifications">
                    	<field name="sequence"/>
                        <field name="year"/>
                        <field name="project_id"/>
                        <field name="program_id"/>
                        <field name="state"/>
                    </tree>
                </field>
            </record>

            <record model="ir.ui.view" id="project_justification_form_view">
                <field name="name">project.justification.form</field>
                <field name="model">project.justification</field>
                <field name="arch" type="xml">
                    <form string="Project Justification">
                    	<group colspan="4" col="6">
                        <field name="sequence" colspan="4"/>
                        <field name="year"/>
                        <newline/>
                        <field name="project_id" on_change="on_change_project(project_id)"/>
                        <field name="program_id"/>
                        </group>
                        <newline/>                        
                        <field name="justification_line_ids" nolabel="1" colspan="4" attrs="{'readonly':[('state','=','done')]}" domain="[('invoice_type', '=', 'in_invoice')]" context="{'tree_view_ref':'onglibre_budgetary.account_invoice_line_just_tree_view', 'form_view_ref':'onglibre_budgetary.account_invoice_line_just_form_view'}"/>
                        <newline/>
                        <field name="state" colspan="2"/>
                        <group colspan="2">                        
	                        <button name="set_done" string="Done" icon="gtk-ok" type="object" colspan="1" attrs="{'invisible':[('state','=', 'done')]}"/>
	                        <button name="set_draft" string="Draft" icon="gtk-cancel" type="object" colspan="1" attrs="{'invisible':[('state','=', 'draft')]}"/>
                    	</group>
                    </form>
                </field>
            </record>

            <record model="ir.actions.act_window" id="action_project_justification_tree_view">
                <field name="name">Project Justification</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">project.justification</field>
                <field name="view_type">form</field>
                <field name="view_mode">tree,form</field>
                <field name="view_id" ref="project_justification_tree_view"/>
            </record>

			<menuitem id="project_justification_menu" name="Project Justification" parent="project.menu_project_management" action="action_project_justification_tree_view"/>

			
    
    </data>
</openerp>